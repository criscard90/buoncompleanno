<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buon compleanno</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* Sfondo con gradient */
        #background {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: radial-gradient(circle, rgba(255, 166, 0, 1) 0%, rgba(110, 0, 0, 1) 100%);
            z-index: -1;
        }
        
        body {
            overflow: hidden;
            font-family: "Georgia", serif;
            color: #f5f0e6;
        }
        
        /* SLIDESHOW CONTAINER: gestisce il fade e nasconde l'overflow dello zoom */
        .slideshow {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            /* Rimosso background-size e background-position */
            transition: opacity 2s ease-in-out; /* Mantiene la transizione di opacit√† */
            filter: brightness(0.85);
            overflow: hidden; /* **CRUCIALE per l'effetto Ken Burns** */
        }
        
        /* KEN BURNS LAYER: gestisce l'immagine e l'animazione */
        #kenburns-layer {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-size: cover;
            background-position: center;
            /* Inizialmente non trasformato */
            transform: scale(1);
            transition: transform 0s; /* Assicura un reset istantaneo della trasformazione */
        }
        
        /* Keyframes per l'Effetto Ken Burns (Zoom/Pan) */
        @keyframes kb-zoom-in {
            0% { transform: scale(1.0); transform-origin: 50% 50%; }
            100% { transform: scale(1.15); transform-origin: 50% 50%; }
        }
        
        @keyframes kb-pan-up-right {
            0% { transform: scale(1.15) translate(0, 0); transform-origin: 50% 50%; }
            100% { transform: scale(1.25) translate(3%, -3%); transform-origin: 50% 50%; }
        }
        
        @keyframes kb-zoom-out-down-left {
            0% { transform: scale(1.2) translate(3%, -3%); transform-origin: 50% 50%; }
            100% { transform: scale(1.05) translate(-3%, 3%); transform-origin: 50% 50%; }
        }
        
        /* 4. Panoramica Lenta da Sinistra a Destra */
        @keyframes kb-pan-left-right {
            0% { 
                transform: scale(1.15) translate(5%, 0); 
                transform-origin: 50% 50%; /* Parte zoomando leggermente e posizionato a sinistra */
            }
            100% { 
                transform: scale(1.15) translate(-5%, 0); 
                transform-origin: 50% 50%; /* Arriva a destra mantenendo lo stesso zoom */
            }
        }
        
        /* 5. Zoom In focalizzato sull'Angolo Basso Destro */
        @keyframes kb-zoom-in-bottom-right {
            0% { 
                transform: scale(1.0); 
                transform-origin: 100% 100%; /* Inizia senza zoom, focalizzato in basso a destra */
            }
            100% { 
                transform: scale(1.2); 
                transform-origin: 100% 100%; /* Zooma verso il punto focale in basso a destra */
            }
        }
        
        /* 6. Zoom Out con Leggera Rotazione */
        @keyframes kb-zoom-out-rotate {
            0% { 
                transform: scale(1.25) rotate(1deg); 
                transform-origin: 50% 50%; /* Inizia zoomato e leggermente ruotato in senso orario */
            }
            100% { 
                transform: scale(1.05) rotate(-2deg); 
                transform-origin: 50% 50%; /* Zooma indietro e ruota leggermente in senso antiorario */
            }
        }
        
        
        /* Classi per applicare le animazioni (Durata 8s - corrispondente a setInterval) */
        .kb-animation-1 { animation: kb-zoom-in 10s linear forwards; }
        .kb-animation-2 { animation: kb-pan-up-right 10s linear forwards; }
        .kb-animation-3 { animation: kb-zoom-out-down-left 10s linear forwards; }
        .kb-animation-4 { animation: kb-pan-left-right 10s linear forwards; }
        .kb-animation-5 { animation: kb-zoom-in-bottom-right 10s linear forwards; }
        .kb-animation-6 { animation: kb-zoom-out-rotate 10s linear forwards; }
        
        
        .overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.35);
        }
        
        .text {
            position: absolute;
            bottom: 18%;
            width: 100%;
            text-align: center;
            font-size: 1.6rem;
            line-height: 1.7;
            padding: 0 12%;
            color: #f5f0e6;
            text-shadow: 0 0 10px rgba(0,0,0,0.4);
            opacity: 0;
            transition: opacity 2s ease-in-out;
        }
        
        .accent {
            color: #cfa46a;
        }
        
        audio { display: none; }
        
        #startScreen {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: radial-gradient(circle at center, #1a1a1a 0%, #0f0f0f 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 10;
            transition: opacity 1s ease-in-out;
        }
        
        #startButton {
            border: 2px solid #cfa46a;
            color: #cfa46a;
            padding: 0.8em 1.6em;
            background: transparent;
            border-radius: 50px;
            font-size: 1.2rem;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: background 0.3s, color 0.3s;
        }
        
        #startButton:hover {
            background: #cfa46a;
            color: #0f0f0f;
        }
        
        @media (max-width: 768px) {
            .text { font-size: 1.8rem; padding: 0 8%; }
            #startButton { font-size: 1rem; padding: 0.7em 1.4em; }
        }
        
        #particles {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            pointer-events: none;
            z-index: 1;
        }
        
        .particle {
            position: absolute;
            border-radius: 50%;
            background: #fff;
            opacity: 0.8;
            pointer-events: none;
            animation-name: float;
            animation-timing-function: linear;
            animation-fill-mode: forwards;
        }
        
        
        @keyframes float {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) scale(0.5);
                opacity: 0;
            }
        }
        
        #endFade {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: black;
            opacity: 0;
            z-index: 20;
            pointer-events: none;
            transition: opacity 4s ease-in-out;
        }
        
        
        
    </style>
</head>
<body>
    
    <div id="background"></div>
    <div id="particles"></div>
    <div id="endFade"></div>
    
    
    <audio id="music" loop>
        <source src="musica.mp3" type="audio/mpeg">
    </audio>
    
    <div id="startScreen">
        <h1 style="color:#f5f0e6; font-weight:400; margin-bottom:1.5em;">Tocca per iniziare üéµ</h1>
        <button id="startButton">Inizia</button>
    </div>
    
    <div id="slides" class="slideshow">
        <div id="kenburns-layer"></div>
    </div>
    <div class="overlay"></div>
    <div id="text" class="text"></div>
    
    <script>
        const images = [
        "foto1.jpg","foto2.jpg","foto3.jpg","foto4.jpg","foto5.jpg",
        "foto6.jpg","foto7.jpg","foto8.jpg","foto9.jpg","foto10.jpg"
        ];
        
        const texts = [
        "Ci sono persone che passano nella nostra vita come comete: lasciano una scia di luce e poi spariscono.",
        "Tu, invece, sei rimasta. Hai acceso quella luce dentro di me e non si √® pi√π spenta.",
        "Amo la tua forza silenziosa, quella che si rivela nei giorni difficili",
        "quando tutto sembra crollare e tu resti in piedi, luminosa.",
        "E tra i doni che la vita mi ha fatto, il pi√π grande sei tu‚Ä¶",
        "e i due piccoli miracoli che portano il tuo sorriso negli occhi.",
        "Sei la mia complice, la mia forza, la mia casa in qualunque posto del mondo.",
        "Non serve aspettare un‚Äôoccasione per dirti quanto ti amo, ma oggi voglio che tu lo senta ancora pi√π forte:",
        "sei la parte migliore della mia vita, il mio capolavoro pi√π bello.",
        "Buon compleanno, amore mio <br><span class='accent'>ti amo ‚ù§Ô∏è</span>"
        ];
        
        const slideEl = document.getElementById("slides");
        const kenBurnsLayer = document.getElementById("kenburns-layer"); // Layer Ken Burns
        const textEl = document.getElementById("text");
        const music = document.getElementById("music");
        const startScreen = document.getElementById("startScreen");
        const startButton = document.getElementById("startButton");
        
        // Array delle classi di Ken Burns disponibili
        const kenBurnsClasses = ["kb-animation-1", "kb-animation-2", "kb-animation-3", "kb-animation-4", "kb-animation-5", "kb-animation-6"]; 
        
        let index = 0; // Indice immagine
        let textIndex = 0; // Indice testo
        let started = false;
        
        let slideCount = 0;
        const totalSlides = images.length;
        // Calcola quante immagini ci sono per ogni frase di testo
        const slidesPerText = Math.floor(images.length / texts.length);
        
        
        // ==========================================================
        // NUOVA CONFIGURAZIONE PARTICELLE
        // ==========================================================
        
        let isBoosted = false; // Stato attuale del boost
        const boostDuration = 3000; // Durata del boost in ms (5 secondi)
        
        // TEMPI DI INIZIO DEL RITORNELLO (in secondi dalla partenza della musica)
        // ** MODIFICA QUESTI VALORI PER SINCRONIZZARE CON LA TUA MUSICA **
        const boostStartTimes = [
            0, 
            30, 
            45,
            66,
            100 
        ];
        
        // ==========================================================
        
        
        function showSlide() {
            
            // 1. RESET: Rimuovi le classi di animazione e forza il reset della trasformazione
            kenBurnsLayer.classList.remove(...kenBurnsClasses);
            kenBurnsLayer.style.transform = 'scale(1)'; 
            void kenBurnsLayer.offsetWidth; // Forzare il browser a registrare il reset
            
            // 2. Imposta la nuova immagine
            kenBurnsLayer.style.backgroundImage = `url(${images[index]})`;
            
            // 3. Applica un'animazione Ken Burns casuale
            const randomClass = kenBurnsClasses[Math.floor(Math.random() * kenBurnsClasses.length)];
            kenBurnsLayer.classList.add(randomClass);
            
            console.log("Immagine mostrata:", images[index], "con animazione:", randomClass);
            
            // 4. Fade-in dello slideshow (la transizione CSS gestisce i 2s)
            slideEl.style.opacity = 1;
        }
        
        function showText() {
            if (textIndex < texts.length) {
                // Aggiorna il contenuto del testo
                textEl.innerHTML = texts[textIndex];
                
                // Fade-in del nuovo testo (la transizione CSS gestisce i 2s)
                textEl.style.opacity = 1; 
            }
        }
        
        
        function nextSlide() {
            // 1. FADE-OUT: Inizia la dissolvenza incrociata per SLIDE e TESTO
            slideEl.style.opacity = 0; 
            textEl.style.opacity = 0;
            
            // 2. Aspetta il completamento del fade-out (2 secondi)
            setTimeout(() => {
                
                // 3. Incrementa gli indici
                slideCount++;
                index = (index + 1) % images.length;
                
                // 4. Logica di avanzamento del testo
                if (slideCount % slidesPerText === 0 && textIndex < texts.length - 1) {
                    textIndex++;
                }
                
                // 5. Carica la nuova slide e la nuova animazione
                showSlide(); 
                // 6. Aggiorna e mostra il nuovo testo
                showText();  
                
                // 7. Controllo di fine
                if (slideCount === totalSlides) {
                    clearInterval(slideInterval); // ferma il ciclo
                    fadeOutMusic();
                    document.getElementById("endFade").style.opacity = 1;
                }
            }, 2000); // 2000ms (2s) √® il tempo di transizione opacit√†
        }
        
        let slideInterval;
        
        function startPresentation() {
            if (started) return;
            started = true;
            
            music.currentTime = 27; 
            music.play().catch(()=>{});
            startScreen.style.opacity = 0;
            setTimeout(() => startScreen.style.display = "none", 1000);
            
            // La prima volta, carichiamo subito la slide 0 e il testo 0
            showSlide();
            showText();
            
            // Avviamo il ciclo dopo il primo intervallo completo
            slideInterval = setInterval(nextSlide, 10000);
            
            // AVVIA LA GENERAZIONE DELLE PARTICELLE E LA SINCRONIZZAZIONE
            startParticleGeneration(); 
            scheduleBoosts();
        }
        
        
        startButton.addEventListener("click", startPresentation);
        
        // ==========================================================
        // FUNZIONI PARTICELLE E BOOST
        // ==========================================================
        
        function createParticle(boosted = false) {
            const particle = document.createElement("div");
            particle.classList.add("particle");
            
            // Dimensione: 6-20px normale, 12-30px potenziata
            const minSize = boosted ? 18 : 6;
            const maxSize = boosted ? 50 : 20;
            const size = minSize + Math.random() * (maxSize - minSize);
            particle.style.width = size + "px";
            particle.style.height = size + "px";
            
            // Posizione casuale
            particle.style.left = Math.random() * window.innerWidth + "px";
            particle.style.top = window.innerHeight + "px";
            
            // Colore casuale
            const colors = ["#fff", "#cfa46a", "#f5f0e6", "#ff9900"];
            particle.style.background = colors[Math.floor(Math.random() * colors.length)];
            
            // Durata: 2-6 secondi normale, 1-3 secondi potenziata (per maggiore velocit√†)
            const minDuration = boosted ? 1 : 2;
            const maxDuration = boosted ? 2 : 6;
            const duration = minDuration + Math.random() * (maxDuration - minDuration);
            particle.style.animationDuration = duration + "s";
            
            // Applica un ritardo di animazione per maggiore casualit√† (opzionale)
            particle.style.animationDelay = (Math.random() * 0.5) + "s";
            
            document.getElementById("particles").appendChild(particle);
            
            // Rimuovi dopo l‚Äôanimazione
            setTimeout(() => particle.remove(), duration * 1000);
        }
        
        
        // Funzione per attivare e disattivare l'effetto boost
        function setBoost(state) {
            isBoosted = state;
            console.log("Boost Particelle:", state ? "ATTIVATO" : "DISATTIVATO");
        }
        
        // Schedula i boost basandosi sull'array boostStartTimes
        function scheduleBoosts() {
            boostStartTimes.forEach(startTime => {
                // Calcola il ritardo in millisecondi
                const delayMs = startTime * 1000;
                
                // Imposta l'attivazione del boost
                setTimeout(() => {
                    if (started) {
                        setBoost(true);
                        
                        // Imposta la disattivazione del boost dopo boostDuration
                        setTimeout(() => {
                            setBoost(false);
                        }, boostDuration);
                    }
                }, delayMs);
            });
        }
        
        // Avvia la generazione continua delle particelle, che si basa sullo stato 'isBoosted'
        function startParticleGeneration() {
             setInterval(() => {
                if (started && Math.random() < 0.9) {
                    // Passa lo stato 'isBoosted' alla funzione createParticle
                    createParticle(isBoosted); 
                }

                console.log("Tempo attuale musica:", music.currentTime.toFixed(1) + "s");

            }, 300); 
        }
        
        // ... (resto del codice per fadeOutMusic)
        
        function fadeOutMusic(duration = 5000) {
            const steps = 30;
            const stepTime = duration / steps;
            let currentStep = 0;
            
            const fade = setInterval(() => {
                currentStep++;
                music.volume = Math.max(0, 1 - currentStep / steps);
                if (currentStep >= steps) {
                    clearInterval(fade);
                    music.pause();
                    music.currentTime = 0; // opzionale: resetta la traccia
                }
            }, stepTime);
        }
        
    </script>
    
</body>
</html>
